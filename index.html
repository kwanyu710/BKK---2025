<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Bangkok 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;800&family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Plus Jakarta Sans"', '"Noto Sans TC"', 'sans-serif'],
                        serif: ['"Playfair Display"', 'serif'],
                    },
                    colors: {
                        'surface': '#FFFFFF',
                        'bg-gray': '#F2F2F7',
                        'ink': '#1C1C1E',
                        'subtle': '#8E8E93',
                        'blue-ios': '#007AFF',
                    },
                    boxShadow: {
                        'soft': '0 8px 24px rgba(0,0,0,0.04)',
                        'float': '0 12px 32px rgba(0,0,0,0.08)',
                        'card': '0 2px 8px rgba(0,0,0,0.04)',
                    },
                    animation: {
                        'slide-up': 'slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                    },
                    keyframes: {
                        slideUp: { '0%': { transform: 'translateY(100%)' }, '100%': { transform: 'translateY(0)' } }
                    }
                }
            }
        }
    </script>
   
    <style>
        body { background-color: #F2F2F7; color: #1C1C1E; -webkit-tap-highlight-color: transparent; user-select: none; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Glassmorphism */
        .glass { 
            background: rgba(255, 255, 255, 0.85); 
            backdrop-filter: blur(20px); 
            -webkit-backdrop-filter: blur(20px); 
            border-top: 1px solid rgba(255,255,255,0.4);
        }

        /* Weather Scroll Snap */
        .weather-container {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            padding-bottom: 10px;
        }
        .weather-item {
            scroll-snap-align: start;
        }

        /* Timeline Line */
        .timeline-line { position: absolute; left: 24px; top: 30px; bottom: -20px; width: 2px; background: #E5E5EA; z-index: 0; }
        .timeline-item:last-child .timeline-line { display: none; }

        /* Bottom Sheet */
        .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 50; opacity: 0; pointer-events: none; transition: opacity 0.3s; }
        .modal-backdrop.open { opacity: 1; pointer-events: auto; }
        .bottom-sheet { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-radius: 32px 32px 0 0; z-index: 60; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.19, 1, 0.22, 1); max-height: 92vh; overflow-y: auto; padding-bottom: 40px; }
        .bottom-sheet.open { transform: translateY(0); }

        /* Interactions */
        .tap-scale:active { transform: scale(0.96); transition: transform 0.1s; }
    </style>
</head>
<body class="pb-32 antialiased">

    <header class="relative h-[40vh] w-full overflow-hidden rounded-b-[40px] shadow-float bg-gray-900 z-0">
        <img src="https://images.unsplash.com/photo-1582468574809-e35935f6532d?q=80&w=1000&auto=format&fit=crop" class="w-full h-full object-cover opacity-80">
        <div class="absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-black/80"></div>
        
        <div class="absolute top-0 w-full p-6 flex justify-between items-start z-20 text-white">
            <div class="text-[10px] font-bold tracking-[0.2em] uppercase opacity-80">Bangkok Trip</div>
            <button onclick="syncToCloud('upload')" class="w-8 h-8 rounded-full bg-white/20 backdrop-blur flex items-center justify-center tap-scale"><i class="fas fa-cloud-upload-alt text-xs"></i></button>
        </div>

        <div class="absolute bottom-8 left-8 right-8 text-white z-10">
            <h1 class="text-4xl font-serif italic mb-2">Sawatdee,<br>Bangkok.</h1>
            <p class="text-sm font-medium opacity-80 mt-2">12/23 ‚Äî 12/28 (6 Days)</p>
        </div>
    </header>

    <main class="px-5 max-w-lg mx-auto min-h-[60vh] relative -mt-6 z-10">
        
        <div id="tab-home" class="section animate-slide-up">
            
            <div class="bg-white/90 backdrop-blur-md rounded-[28px] p-4 shadow-soft mb-6 overflow-hidden border border-white/50">
                <div class="flex items-center justify-between mb-3 px-2">
                    <span class="text-xs font-bold text-subtle uppercase"><i class="fas fa-location-arrow mr-1"></i> Bangkok</span>
                    <span class="text-xs font-bold text-ink" id="header-temp">32¬∞C</span>
                </div>
                <div class="weather-container hide-scrollbar gap-5 px-2" id="weather-scroll">
                    </div>
            </div>

            <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="bg-white rounded-[28px] p-5 shadow-card relative overflow-hidden h-32 flex flex-col justify-between">
                    <p class="text-[10px] tracking-widest text-subtle uppercase">Rate (TWD)</p>
                    <p class="text-3xl font-serif font-bold text-ink" id="dash-rate">0.92</p>
                    <p class="text-[10px] text-green-600 font-bold bg-green-50 w-max px-2 py-1 rounded-full">Live</p>
                </div>
                <div class="bg-ink text-white rounded-[28px] p-5 shadow-float h-32 flex flex-col justify-between tap-scale" onclick="switchTab('tab-account')">
                    <p class="text-[10px] tracking-widest opacity-60 uppercase">Budget</p>
                    <p class="text-2xl font-serif font-bold truncate" id="home-fund-display">‡∏ø0</p>
                    <div class="self-end opacity-20"><i class="fas fa-wallet text-2xl"></i></div>
                </div>
            </div>

            <div class="bg-white rounded-[28px] p-2 shadow-card flex items-center mb-6">
                <div class="w-10 h-10 rounded-full bg-yellow-400 text-ink flex items-center justify-center font-bold flex-shrink-0"><i class="fas fa-language"></i></div>
                <input type="text" id="thai-input" placeholder="ÁøªË≠ØÊàêÊ≥∞Êñá..." class="flex-1 bg-transparent px-4 text-sm font-medium outline-none h-full">
                <button onclick="translateThai()" class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-ink tap-scale"><i class="fas fa-arrow-right"></i></button>
            </div>

            <button onclick="switchTab('tab-itinerary')" class="w-full bg-white p-6 rounded-[28px] shadow-card flex items-center justify-between tap-scale">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-blue-50 text-blue-500 flex items-center justify-center text-xl"><i class="fas fa-map-marked-alt"></i></div>
                    <div>
                        <span class="block text-lg font-bold text-ink">ÊàëÁöÑË°åÁ®ã</span>
                        <span class="text-xs text-subtle">Êü•ÁúãÊØèÊó•ÂÆâÊéí</span>
                    </div>
                </div>
                <i class="fas fa-chevron-right text-gray-300"></i>
            </button>
        </div>

        <div id="tab-itinerary" class="hidden">
            <div class="sticky top-0 bg-[#F2F2F7]/95 backdrop-blur z-30 pt-2 pb-4">
                <div class="flex justify-between items-center mb-3 px-1">
                    <h2 class="text-2xl font-serif font-bold">Itinerary</h2>
                    <div class="flex gap-2">
                        <button onclick="openSortModal()" class="w-8 h-8 rounded-full bg-white shadow-sm flex items-center justify-center text-subtle tap-scale"><i class="fas fa-sort"></i></button>
                        <button onclick="openEditModal()" class="w-8 h-8 rounded-full bg-ink text-white shadow-lg flex items-center justify-center tap-scale"><i class="fas fa-plus"></i></button>
                    </div>
                </div>
                <div class="flex overflow-x-auto hide-scrollbar gap-3 pb-2 pr-4" id="day-tabs">
                    </div>
            </div>

            <div id="itinerary-content" class="pb-24 space-y-0">
                </div>
        </div>

        <div id="tab-account" class="hidden pb-24">
             <h2 class="text-2xl font-serif font-bold mb-6 px-2">Wallet</h2>
             
             <div class="bg-white rounded-[32px] p-6 shadow-soft mb-6">
                 <div class="text-center mb-6">
                     <p class="text-xs text-subtle uppercase tracking-widest">Balance (THB)</p>
                     <p class="text-4xl font-bold mt-2 text-ink" id="acc-fund-display">‡∏ø0</p>
                 </div>
                 
                 <div class="space-y-4">
                     <div class="bg-gray-50 rounded-2xl p-2 flex items-center">
                         <span class="pl-4 font-bold text-gray-400">‡∏ø</span>
                         <input type="number" id="amt-input" placeholder="0" class="flex-1 bg-transparent p-2 text-2xl font-bold outline-none">
                     </div>
                     <div class="flex gap-2 overflow-x-auto hide-scrollbar" id="cat-container"></div>
                     <div class="flex gap-2 flex-wrap" id="payer-container"></div>
                     <div class="flex gap-2">
                         <input type="text" id="note-input" placeholder="ÂÇôË®ª..." class="flex-1 bg-gray-50 rounded-xl px-4 text-sm outline-none">
                         <button onclick="submitTx()" class="w-12 h-12 bg-ink text-white rounded-xl shadow-lg tap-scale flex items-center justify-center"><i class="fas fa-check"></i></button>
                     </div>
                 </div>
             </div>

             <div id="tx-history" class="space-y-3 px-2"></div>
        </div>

        <div id="tab-checklist" class="hidden pb-24">
            <h2 class="text-2xl font-serif font-bold mb-6 px-2">Checklist</h2>
            <div id="checklist-container" class="space-y-4"></div>
            
            <div class="mt-10 bg-white rounded-[28px] p-6 shadow-soft">
                <h3 class="font-bold mb-4 text-sm"><i class="fas fa-cog mr-2"></i>Settings</h3>
                <div class="flex gap-3 mb-4">
                    <button onclick="syncToCloud('download')" class="flex-1 py-3 border border-gray-200 rounded-xl text-xs font-bold tap-scale">‰∏ãËºâÈõ≤Á´ØÂÇô‰ªΩ</button>
                    <button onclick="syncToCloud('upload')" class="flex-1 py-3 bg-ink text-white rounded-xl text-xs font-bold tap-scale">‰∏äÂÇ≥Êú¨Ê©üË≥áÊñô</button>
                </div>
                <button onclick="hardReset()" class="w-full text-center text-[10px] text-red-300">ÈáçÁΩÆÊâÄÊúâË≥áÊñô</button>
            </div>
        </div>

    </main>

    <nav class="fixed bottom-8 left-1/2 transform -translate-x-1/2 glass rounded-full px-6 py-4 shadow-float z-40 flex gap-8 items-center border border-white/50">
        <button onclick="switchTab('tab-home')" class="nav-btn active text-subtle hover:text-ink transition tap-scale" data-target="tab-home"><i class="fas fa-home text-xl"></i></button>
        <button onclick="switchTab('tab-itinerary')" class="nav-btn text-subtle hover:text-ink transition tap-scale" data-target="tab-itinerary"><i class="fas fa-map text-xl"></i></button>
        <button onclick="switchTab('tab-account')" class="nav-btn text-subtle hover:text-ink transition tap-scale" data-target="tab-account"><i class="fas fa-wallet text-xl"></i></button>
        <button onclick="switchTab('tab-checklist')" class="nav-btn text-subtle hover:text-ink transition tap-scale" data-target="tab-checklist"><i class="fas fa-list-check text-xl"></i></button>
    </nav>

    <div id="detail-modal-backdrop" class="modal-backdrop" onclick="closeModal('detail-modal')"></div>
    <div id="detail-modal" class="bottom-sheet">
        <div id="detail-content" class="p-6"></div>
    </div>

    <div id="edit-modal-backdrop" class="modal-backdrop" onclick="closeModal('edit-modal')"></div>
    <div id="edit-modal" class="bottom-sheet p-6">
        <div class="w-12 h-1.5 bg-gray-200 rounded-full mx-auto mb-6"></div>
        <h3 class="font-bold text-xl mb-4" id="edit-title">Á∑®ËºØË°åÁ®ã</h3>
        <input type="hidden" id="edit-index">
        <div class="space-y-4">
            <div class="flex gap-3">
                <input type="text" id="edit-time" class="w-24 bg-gray-50 rounded-2xl p-3 font-bold text-center outline-none" placeholder="ÊôÇÈñì">
                <input type="text" id="edit-name" class="flex-1 bg-gray-50 rounded-2xl p-3 font-bold outline-none" placeholder="ÂêçÁ®±">
            </div>
            <input type="text" id="edit-desc" class="w-full bg-gray-50 rounded-2xl p-3 text-sm outline-none" placeholder="Á∞°Áü≠ÊèèËø∞">
            <input type="text" id="edit-local" class="w-full bg-blue-50 text-blue-800 rounded-2xl p-3 text-sm outline-none font-bold" placeholder="Ê≥∞ÊñáÂêçÁ®± (Áµ¶Âè∏Ê©üÁúã)">
            <textarea id="edit-deep" class="w-full bg-gray-50 rounded-2xl p-3 text-sm h-24 outline-none" placeholder="Ê∑±Â∫¶Â∞éË¶ΩÂÖßÂÆπ..."></textarea>
            <div class="flex gap-2">
                 <input type="text" id="edit-link" class="flex-1 bg-gray-50 rounded-2xl p-3 text-xs outline-none" placeholder="Google Maps ÈÄ£Áµê">
                 <input type="text" id="edit-icon" class="w-1/3 bg-gray-50 rounded-2xl p-3 text-xs outline-none" placeholder="Icon (fa-star)">
            </div>
        </div>
        <div class="flex gap-3 mt-6">
            <button onclick="deleteSpot()" id="btn-delete" class="p-4 rounded-2xl bg-red-50 text-red-500 font-bold"><i class="fas fa-trash"></i></button>
            <button onclick="saveSpot()" class="flex-1 bg-ink text-white font-bold rounded-2xl shadow-lg tap-scale">ÂÑ≤Â≠ò</button>
        </div>
    </div>
    
    <div id="sort-modal-backdrop" class="modal-backdrop" onclick="closeModal('sort-modal')"></div>
    <div id="sort-modal" class="bottom-sheet p-6 h-[80vh]">
         <div class="w-12 h-1.5 bg-gray-200 rounded-full mx-auto mb-6"></div>
         <h3 class="font-bold text-xl mb-4">Ë™øÊï¥È†ÜÂ∫è</h3>
         <div id="sort-list-container" class="space-y-2"></div>
         <button onclick="confirmSort()" class="w-full bg-ink text-white font-bold py-4 rounded-2xl mt-6 shadow-lg">Á¢∫Ë™çÊéíÂ∫è</button>
    </div>

    <div id="speak-modal" class="fixed inset-0 bg-black z-[100] hidden flex-col items-center justify-center text-center p-6 transition-opacity duration-300" onclick="this.classList.add('hidden')">
        <p class="text-gray-500 text-xs uppercase tracking-widest border border-gray-700 px-3 py-1 rounded-full mb-10">Show to Driver / Staff</p>
        <h2 id="speak-cn" class="text-white text-2xl font-bold mb-2"></h2>
        <h1 id="speak-th" class="text-white text-6xl font-bold leading-tight select-all"></h1>
        <p class="text-white/30 text-xs mt-20 animate-pulse">Tap anywhere to close</p>
    </div>

<script>
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxYeyHua8VRjHu3dHbP3glwWcFf5zClFG_drBD9gR_j9MZpcGf6uajQUzmOw_Au_o0o/exec';

    // --- RICH DATA WITH DEEP GUIDE (HARDCODED FOR SAFETY) ---
    const DEFAULT_ITINERARY = [
        { "day": 1, "date": "12/23 (Mon)", "spots": [ 
            { "time": "18:00", "name": "Âá∫Áôº", "desc": "È´òÈõÑÊ©üÂ†¥ -> ÂªäÊõº(DMK)", "icon": "fa-plane", "local": "‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô‡∏î‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á", "deep_desc": "Êê≠‰πòÊ≥∞‰∫ûËà™ FD235„ÄÇÊäµÈÅîÂæåË´ãÊ≥®ÊÑèÔºö\n1. ÂªäÊõºÊ©üÂ†¥ÈÄöÈóúËºÉÂø´„ÄÇ\n2. Âè´ Grab Ë´ãÈÅ∏ 1 Ê®ìÂ§ñÁöÑÊé•ÈÄÅÈªû„ÄÇ\n3. Ê∫ñÂÇôÂ•ΩË≠∑ÁÖßËàáÈõªÂ≠êÁ∞ΩË≠âÊà™Âúñ„ÄÇ" }, 
            { "time": "22:30", "name": "Check-in", "desc": "B2 Âîê‰∫∫Ë°óÈ£ØÂ∫ó", "icon": "fa-bed", "local": "B2 China Town Yaowarat Premier Hotel", "link": "http://maps.google.com/?q=B2+China+Town", "deep_desc": "‰ΩçÊñºÂîê‰∫∫Ë°óÂøÉËáüÂú∞Â∏∂ÔºåÂ∑•Ê•≠È¢®Ë®≠Ë®à„ÄÇËµ∞Ë∑Ø 3 ÂàÜÈêòÂà∞ MRT Wat Mangkon„ÄÇÊ´ÉÂè∞ÈÄöÂ∏∏ÊúâÊúÉË¨õ‰∏≠ÊñáÁöÑÊúçÂãô‰∫∫Âì°„ÄÇ" },
            { "time": "23:00", "name": "Âîê‰∫∫Ë°óÂÆµÂ§ú", "desc": "T&K Êµ∑ÈÆÆÂ§ßÊéíÊ™î", "icon": "fa-utensils", "local": "‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£ T&K Seafood (‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß)", "link": "http://maps.google.com/?q=T&K+Seafood", "deep_desc": "ÊõºË∞∑Âîê‰∫∫Ë°óÂøÖÂêÉÔºÅË™çÊòé„ÄåÁ∂†Ëâ≤Âà∂Êúç„ÄçÂì°Â∑•„ÄÇÂøÖÈªûÔºö\n1. ÁÇ≠ÁÉ§Â§ßÈ†≠Ëù¶ (Grilled Prawns)\n2. ÂíñÂì©ËûÉËüπ\n3. ÈÆÆËöµÁÖéËõã\nÁí∞Â¢ÉËºÉÂêµÈõúÔºåÊòØÈ´îÈ©óÊõºË∞∑Ë°óÈ†≠Ê¥ªÂäõÁöÑÂ•ΩÂú∞Êñπ„ÄÇ" }
        ] },
        { "day": 2, "date": "12/24 (Tue)", "spots": [ 
            { "time": "09:30", "name": "Áü≥ÈæçËªçË∑Ø", "desc": "ËÄÅÂüéÂçÄÊñáÈùíÊó©È§ê", "icon": "fa-coffee", "local": "‡∏ñ‡∏ô‡∏ô‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡∏Å‡∏£‡∏∏‡∏á", "deep_desc": "Charoen Krung ÊòØÊõºË∞∑Á¨¨‰∏ÄÊ¢ùÈ¶¨Ë∑Ø„ÄÇÊé®Ëñ¶Ôºö\n1. ‰ªÅÂíåÂúíÊ∂ºËå∂ (ÁôæÂπ¥ËÄÅÂ∫ó)\n2. ÁéãÂ≠êÊà≤Èô¢Ë±¨ËÇâÁ≤• (Á±≥ÂÖ∂ÊûóÂøÖÊØîÁôª)\nÈÄôË£°ÂÖÖÊªøÊñ∞ËàäËûçÂêàÁöÑÊ∞õÂúçÔºåÈÅ©ÂêàË°óÊãç„ÄÇ" },
            { "time": "11:00", "name": "Ëá•‰ΩõÂØ∫", "desc": "ÊúÄÂ§ßËá•‰Ωõ & ÊåâÊë©", "icon": "fa-gopuram", "local": "‡∏ß‡∏±‡∏î‡πÇ‡∏û‡∏ò‡∏¥‡πå (Wat Pho)", "deep_desc": "ÊìÅÊúâÂÖ®Ê≥∞ÂúãÊúÄÂ§ßÁöÑËá•‰ΩõÂÉè (46Á±≥)„ÄÇÈÄôË£°‰πüÊòØÊ≥∞ÂºèÊåâÊë©ÁöÑÁôºÊ∫êÂú∞ÔºåÈÄõÁ¥Ø‰∫ÜÂèØ‰ª•Áõ¥Êé•Âú®ÂØ∫ÂÖßÁöÑÊåâÊë©Â≠∏Ê†°È´îÈ©óÊúÄÊ≠£ÂÆóÁöÑÂè§Ê≥ïÊåâÊë©„ÄÇ" },
            { "time": "13:30", "name": "ÈÑ≠ÁéãÂªü", "desc": "ÈªéÊòéÂØ∫ÊãçÁæéÁÖß", "icon": "fa-camera", "local": "‡∏ß‡∏±‡∏î‡∏≠‡∏£‡∏∏‡∏ì (Wat Arun)", "deep_desc": "ËëóÂêçÁöÑÁôΩËâ≤‰ΩõÂ°îÔºå‰∏äÈù¢Èë≤Êªø‰∫ÜÂΩ©Ëâ≤Á¢éÁì∑Áâá„ÄÇÂª∫Ë≠∞Á©øËëóÈ°èËâ≤ÈÆÆË±îÁöÑË°£Êúç‰æÜÊãçÁÖßÔºåÂ∞çÊØîÂ∫¶ÊúÉÂæàÁæé„ÄÇÊ≥®ÊÑèÊúçË£ùÈúÄÊúâË¢ñ‰∏îÈÅéËÜù„ÄÇ" },
            { "time": "19:00", "name": "Êò≠Êä´ËÄ∂Ê≤≥ÈÅäËàπ", "desc": "ÈÉµËº™ÊôöÈ§ê", "icon": "fa-ship", "local": "‡∏•‡πà‡∏≠‡∏á‡πÄ‡∏£‡∏∑‡∏≠‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡πÄ‡∏à‡πâ‡∏≤‡∏û‡∏£‡∏∞‡∏¢‡∏≤", "deep_desc": "Âæû River City Á¢ºÈ†≠Âá∫Áôº„ÄÇÂú®Ëàπ‰∏äÊ¨£Ë≥ûÂ§úÈñìÈªûÁáàÁöÑÈÑ≠ÁéãÂªüÂíåÂ§ßÁöáÂÆÆÔºåÊôØËâ≤ÊØîÁôΩÂ§©Êõ¥Â£ØËßÄ„ÄÇ‰∫´ÂèóÊ≤≥È¢®Ëàá Buffet„ÄÇ" }
        ] },
        { "day": 3, "date": "12/25 (Wed)", "spots": [ 
            { "time": "10:00", "name": "Âµ©Ë∂äË∑Ø", "desc": "Song Wat ÊñáÂâµË°ó", "icon": "fa-palette", "local": "‡∏ñ‡∏ô‡∏ô‡∏ó‡∏£‡∏á‡∏ß‡∏≤‡∏î", "deep_desc": "ËøëÊúüÊõºË∞∑ÊúÄÁ¥ÖÁöÑÊñáÈùíË°óÂçÄÔºÅËÄÅÂÄâÂ∫´ÊîπÂª∫ÁöÑÂíñÂï°Âª≥ËàáËóùÂªä„ÄÇÂøÖÂéªÔºöFV Cafe (ËÄÅÊàøÂ≠êÊîπÂª∫)„ÄÅÁâÜ‰∏äÁöÑÂ§ßË±°Â°óÈ¥â„ÄÇ" },
            { "time": "14:00", "name": "ÈÄöÁæÖÂïÜÂúà", "desc": "‰∏ãÂçàËå∂ & ÈÄõË°ó", "icon": "fa-shopping-bag", "local": "‡∏ó‡∏≠‡∏á‡∏´‡∏•‡πà‡∏≠ (Thong Lor)", "deep_desc": "ÊõºË∞∑ÁöÑ„ÄåÂ∞èÊó•Êú¨„ÄçÂØå‰∫∫ÂçÄ„ÄÇÈÄôË£°ÊúâÊúÄÈ´òÂØÜÂ∫¶ÁöÑÁ∂≤ÁæéÂíñÂï°Âª≥ (Â¶Ç Patom Organic Living) ÂíåÈö±ËóèÂºèÈÖíÂêß (Speakeasy Bar)„ÄÇ" },
            { "time": "18:00", "name": "ICONSIAM", "desc": "ÂÆ§ÂÖßÊ∞¥‰∏äÂ∏ÇÂ†¥", "icon": "fa-store", "local": "‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏™‡∏¢‡∏≤‡∏°", "deep_desc": "ÊõºË∞∑ÊúÄÊµÆË™áÁöÑÁôæË≤®„ÄÇÂøÖÈÄõ G Ê®ìÁöÑ SookSiam ÂÆ§ÂÖßÊ∞¥‰∏äÂ∏ÇÂ†¥ÔºåÂèØ‰ª•Âú®ÂÜ∑Ê∞£ÊàøÂÖßÂêÉÂà∞Ê≥∞ÂúãÂêÑÂú∞ÁöÑÂ§úÂ∏ÇÂ∞èÂêÉÔºåÂÉπÊ†ºÊØîÂ§ñÈù¢Á®çË≤¥‰ΩÜË°õÁîüËàíÈÅ©„ÄÇ" }
        ] },
        { "day": 4, "date": "12/26 (Thu)", "spots": [ 
            { "time": "08:00", "name": "ÂåÖËªäÂá∫Áôº", "desc": "ÂâçÂæÄÊ∞¥‰∏äÂ∏ÇÂ†¥", "icon": "fa-car", "local": "", "deep_desc": "Ë∑ØÁ®ãËºÉÈÅ† (Á¥Ñ 1.5-2 Â∞èÊôÇ)ÔºåË´ãÂ§ßÂÆ∂Ê∫ñÊôÇÈõÜÂêà„ÄÇÂè∏Ê©üÈÄöÂ∏∏ÊúÉËµ∞È´òÈÄüÂÖ¨Ë∑ØÔºåÈÅéË∑ØË≤ªÈúÄÈ°çÂ§ñÊîØ‰ªòÁµ¶Âè∏Ê©ü„ÄÇ" },
            { "time": "10:00", "name": "ÁæéÂäüÈêµÈÅì", "desc": "ÁúãÁÅ´ËªäÈÄ≤Á´ô", "icon": "fa-train", "local": "‡∏ï‡∏•‡∏≤‡∏î‡∏£‡πà‡∏°‡∏´‡∏∏‡∏ö", "deep_desc": "‰∏ñÁïåÂ•áÊôØÔºÅÁÅ´ËªäÁ∂ìÈÅéÊôÇÊî§Ë≤©Êî∂Ê£öÂ≠ê„ÄÇÊúÄ‰Ω≥ÊãçÊîùÈªûÊòØÂú®ÈêµÈÅìËΩâÂΩéËôï„ÄÇÊ≥®ÊÑèÁÅ´ËªäÁ∂ìÈÅéÊôÇÈùûÂ∏∏Ë≤ºËøëÔºåÂãôÂøÖÊ≥®ÊÑèÂÆâÂÖ®„ÄÇ" },
            { "time": "12:00", "name": "‰∏πÂ´©ËééÊúµ", "desc": "ÊâãÊêñËàπÈ´îÈ©ó", "icon": "fa-water", "local": "‡∏ï‡∏•‡∏≤‡∏î‡∏ô‡πâ‡∏≥‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏™‡∏∞‡∏î‡∏ß‡∏Å", "deep_desc": "ËßÄÂÖâÂÆ¢ÂøÖÂéªÁöÑÊ∞¥‰∏äÂ∏ÇÂ†¥„ÄÇÈ´îÈ©óÊâãÊêñËàπÂ°ûËàπÁöÑÊ®ÇË∂£„ÄÇËàπ‰∏äË≤∑Êù±Ë•øË®òÂæóÊÆ∫ÂÉπÔºåÈÄöÂ∏∏Âæû 3-4 ÊäòÈñãÂßãÂñä„ÄÇ" }
        ] },
        { "day": 5, "date": "12/27 (Fri)", "spots": [ 
            { "time": "10:00", "name": "ÊÅ∞ÂúñÊÅ∞Â∏ÇÈõÜ", "desc": "ÈÄ±Êú´Â∏ÇÈõÜ", "icon": "fa-gift", "local": "‡∏ï‡∏•‡∏≤‡∏î‡∏ô‡∏±‡∏î‡∏à‡∏ï‡∏∏‡∏à‡∏±‡∏Å‡∏£", "deep_desc": "‰∏ñÁïåÊúÄÂ§ßÈÄ±Êú´Â∏ÇÈõÜÔºÅÁúãÂà∞ÂñúÊ≠°ÁöÑÂ∞±Ë≤∑ÔºåÂõ†ÁÇ∫ÂõûÈ†≠ÂæàÈõ£ÂÜçÊâæÂà∞Âêå‰∏ÄÂÆ∂Â∫ó„ÄÇÊé®Ëñ¶Ë≤∑ÔºöÈ¶ôÊ∞õ„ÄÅÊ≥∞ÂºèÊñáÂâµTÊÅ§„ÄÅÊú®Ë£ΩÈ§êÂÖ∑„ÄÇ" }
        ] }
    ];

    let state = {
        users: ["K","F","J","R","C","Fund"],
        fundBalance: 0,
        transactions: [],
        checklist: [{"title":"Documents","items":[{"name":"Passport","checked":true}]}],
        itinerary: DEFAULT_ITINERARY, 
        currentDay: 0
    };
    
    let sortable = null;

    document.addEventListener('DOMContentLoaded', () => {
        loadData();
        renderWeather();
        renderItinerary();
        renderWallet();
        renderChecklist();
        autoSync();
    });

    // --- 1. WEATHER (iOS Style Horizontal) ---
    function renderWeather() {
        // Simulated Hourly Data
        const hours = [
            {t:'Now', i:'fa-sun', T:'32¬∞'}, {t:'1PM', i:'fa-cloud-sun', T:'33¬∞'}, 
            {t:'2PM', i:'fa-cloud', T:'33¬∞'}, {t:'3PM', i:'fa-cloud-rain', T:'30¬∞'},
            {t:'4PM', i:'fa-bolt', T:'29¬∞'}, {t:'5PM', i:'fa-cloud', T:'28¬∞'},
            {t:'6PM', i:'fa-moon', T:'28¬∞'}, {t:'7PM', i:'fa-moon', T:'27¬∞'}
        ];
        document.getElementById('weather-scroll').innerHTML = hours.map(h => `
            <div class="weather-item flex flex-col items-center justify-between min-w-[50px] h-[70px]">
                <span class="text-[10px] font-bold text-subtle">${h.t}</span>
                <i class="fas ${h.i} text-lg text-ink my-1"></i>
                <span class="text-sm font-bold text-ink">${h.T}</span>
            </div>
        `).join('');
    }

    // --- 2. ITINERARY (Card + Bottom Sheet) ---
    function renderItinerary() {
        // Date Tabs (Scrollable)
        document.getElementById('day-tabs').innerHTML = state.itinerary.map((d, i) => `
            <button onclick="setDay(${i})" class="flex-shrink-0 px-4 py-2 rounded-full border transition-all ${state.currentDay===i ? 'bg-ink text-white border-ink shadow-md' : 'bg-white text-subtle border-transparent'}">
                <span class="text-xs font-bold whitespace-nowrap">${d.date}</span>
            </button>
        `).join('');

        const d = state.itinerary[state.currentDay];
        const container = document.getElementById('itinerary-content');
        
        container.innerHTML = d.spots.map((s, idx) => `
            <div class="timeline-item relative pl-10 pb-6 last:pb-0 group" onclick="openDetail(${idx})">
                <div class="timeline-line"></div>
                <div class="absolute left-[20px] top-[24px] w-2.5 h-2.5 rounded-full bg-ink border-2 border-white shadow z-10"></div>
                
                <span class="text-[10px] font-bold text-subtle absolute left-10 top-0">${s.time}</span>
                
                <div class="bg-white rounded-[24px] p-5 shadow-card mt-5 relative overflow-hidden tap-scale transition-all active:shadow-none">
                    <div class="flex items-center justify-between mb-1">
                        <h3 class="font-bold text-lg text-ink">${s.name}</h3>
                        <i class="fas ${s.icon} text-gray-200 text-xl"></i>
                    </div>
                    <p class="text-xs text-subtle line-clamp-1">${s.desc}</p>
                    ${s.local ? '<div class="absolute bottom-2 right-4 w-2 h-2 rounded-full bg-blue-500"></div>' : ''}
                </div>
            </div>
        `).join('');
    }
    function setDay(i) { state.currentDay = i; renderItinerary(); }

    // --- 3. BOTTOM SHEET DETAIL LOGIC ---
    function openDetail(idx) {
        const s = state.itinerary[state.currentDay].spots[idx];
        const modal = document.getElementById('detail-modal');
        const content = document.getElementById('detail-content');
        
        // Populate Content
        content.innerHTML = `
            <div class="w-12 h-1.5 bg-gray-200 rounded-full mx-auto mb-6"></div>
            
            <div class="flex justify-between items-start mb-4">
                <div>
                    <span class="text-xs font-bold text-blue-500 bg-blue-50 px-2 py-1 rounded-lg mb-2 inline-block">${s.time}</span>
                    <h2 class="text-3xl font-serif font-bold text-ink">${s.name}</h2>
                    <p class="text-sm text-subtle">${s.desc}</p>
                </div>
                <button onclick="openEditModal(${idx})" class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-subtle"><i class="fas fa-pen text-xs"></i></button>
            </div>

            <div class="bg-bg-gray rounded-2xl p-4 mb-4 border border-gray-200">
                <p class="text-[10px] font-bold text-subtle uppercase tracking-widest mb-2"><i class="fas fa-book-open mr-1"></i> Ê∑±Â∫¶Â∞éË¶Ω</p>
                <p class="text-sm text-ink leading-relaxed whitespace-pre-line">${s.deep_desc || 'Â∞öÁÑ°Ë©≥Á¥∞‰ªãÁ¥π„ÄÇ'}</p>
            </div>

            <div class="space-y-3">
                ${s.local ? `
                <button onclick="showSpeak('${s.name}', '${s.local}')" class="w-full py-4 bg-ink text-white rounded-2xl shadow-lg font-bold flex items-center justify-center gap-2 tap-scale">
                    <i class="fas fa-expand"></i> üó£Ô∏è Áµ¶Âè∏Ê©ü/Â∫óÂì°Áúã (Â§ßÂ≠óÂç°)
                </button>` : ''}
                
                ${s.link ? `
                <a href="${s.link}" target="_blank" class="w-full py-3 bg-white border border-gray-200 text-ink rounded-2xl font-bold flex items-center justify-center gap-2 tap-scale">
                    <i class="fas fa-map-location-dot text-blue-500"></i> Google Maps Â∞éËà™
                </a>` : ''}
            </div>
        `;
        
        document.getElementById('detail-modal-backdrop').classList.add('open');
        modal.classList.add('open');
    }

    // --- 4. POINT & SPEAK ---
    function showSpeak(cn, th) {
        document.getElementById('speak-cn').innerText = cn;
        document.getElementById('speak-th').innerText = th;
        document.getElementById('speak-modal').classList.remove('hidden');
    }

    // --- 5. EDIT/ADD LOGIC ---
    function openEditModal(idx = -1) {
        closeModal('detail-modal'); // Close detail first
        const isNew = idx === -1;
        const s = isNew ? {} : state.itinerary[state.currentDay].spots[idx];
        
        document.getElementById('edit-title').innerText = isNew ? 'Êñ∞Â¢ûË°åÁ®ã' : 'Á∑®ËºØË°åÁ®ã';
        document.getElementById('edit-index').value = idx;
        document.getElementById('btn-delete').style.display = isNew ? 'none' : 'block';
        
        ['time','name','desc','local','deep_desc','link','icon'].forEach(k => {
            const id = 'edit-' + k.replace('deep_desc','deep');
            document.getElementById(id).value = s[k] || '';
        });
        
        document.getElementById('edit-modal-backdrop').classList.add('open');
        document.getElementById('edit-modal').classList.add('open');
    }

    function saveSpot() {
        const idx = document.getElementById('edit-index').value;
        const s = {
            time: document.getElementById('edit-time').value,
            name: document.getElementById('edit-name').value,
            desc: document.getElementById('edit-desc').value,
            local: document.getElementById('edit-local').value,
            deep_desc: document.getElementById('edit-deep').value,
            link: document.getElementById('edit-link').value,
            icon: document.getElementById('edit-icon').value || 'fa-map-marker-alt'
        };
        
        if(idx == -1) state.itinerary[state.currentDay].spots.push(s);
        else state.itinerary[state.currentDay].spots[idx] = s;
        
        saveData(); renderItinerary(); closeModal('edit-modal');
    }

    function deleteSpot() {
        const idx = document.getElementById('edit-index').value;
        if(confirm("Á¢∫ÂÆöÂà™Èô§?")) {
            state.itinerary[state.currentDay].spots.splice(idx,1);
            saveData(); renderItinerary(); closeModal('edit-modal');
        }
    }
    
    // Sort Logic
    function openSortModal() {
        const spots = state.itinerary[state.currentDay].spots;
        if(!spots || spots.length === 0) return alert("ÁÑ°Ë°åÁ®ã");
        document.getElementById('sort-list-container').innerHTML = spots.map((s, i) => `
            <div class="bg-gray-50 p-3 rounded-xl flex items-center justify-between" data-id="${i}">
                <span class="font-bold text-sm text-gray-700 truncate"><i class="fas ${s.icon} mr-2 text-gray-400"></i>${s.name}</span>
                <i class="fas fa-bars text-gray-300"></i>
            </div>`).join('');
        document.getElementById('sort-modal-backdrop').classList.add('open');
        document.getElementById('sort-modal').classList.add('open');
        if(sortable) sortable.destroy();
        sortable = new Sortable(document.getElementById('sort-list-container'), { animation: 150 });
    }
    function confirmSort() {
        const newOrder = sortable.toArray();
        const currentSpots = state.itinerary[state.currentDay].spots;
        state.itinerary[state.currentDay].spots = newOrder.map(i => currentSpots[parseInt(i)]);
        saveData(); renderItinerary(); closeModal('sort-modal');
    }


    // --- UTILS ---
    function switchTab(id) {
        document.querySelectorAll('.section').forEach(e => e.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        document.getElementById(id).classList.add('animate-slide-up');
        document.querySelectorAll('.nav-btn').forEach(b => { b.classList.remove('text-ink'); b.classList.add('text-subtle'); });
        document.querySelector(`[data-target="${id}"]`).classList.replace('text-subtle','text-ink');
    }
    
    function closeModal(id) {
        document.getElementById(id).classList.remove('open');
        document.getElementById(id+'-backdrop').classList.remove('open');
    }

    // --- WALLET & CHECKLIST (Standard Logic) ---
    let acc = { cat: 'Food', payer: 'Fund', split: 'shared' };
    function renderWallet() {
        document.getElementById('cat-container').innerHTML = ['Food','Ride','Shop','Stay'].map(c => 
            `<button onclick="acc.cat='${c}'; renderWalletUI()" class="w-12 h-12 rounded-full border border-gray-100 flex items-center justify-center text-subtle ${acc.cat===c?'bg-ink text-white':''}"><i class="fas fa-${{'Food':'utensils','Ride':'car','Shop':'bag-shopping','Stay':'bed'}[c]}"></i></button>`
        ).join('');
        document.getElementById('payer-container').innerHTML = state.users.map(u => 
            `<button onclick="acc.payer='${u}'; renderWalletUI()" class="px-3 py-1 rounded-full text-xs font-bold border ${acc.payer===u?'bg-ink text-white':'bg-white text-subtle'}">${u}</button>`
        ).join('');
        document.getElementById('acc-fund-display').innerText = '‡∏ø' + state.fundBalance.toLocaleString();
        document.getElementById('home-fund-display').innerText = '‡∏ø' + state.fundBalance.toLocaleString();
        document.getElementById('tx-history').innerHTML = state.transactions.slice(0,8).map(t => 
            `<div class="flex justify-between py-3 border-b border-gray-50"><span class="text-sm font-bold">${t.note||t.cat}</span><span class="font-bold">${t.amt}</span></div>`
        ).join('');
    }
    function renderWalletUI() { renderWallet(); } // Refresh UI
    function submitTx() {
        const amt = parseInt(document.getElementById('amt-input').value);
        const note = document.getElementById('note-input').value;
        if(!amt) return;
        if(acc.split === 'deposit') state.fundBalance += amt; else if (acc.payer === 'Fund') state.fundBalance -= amt;
        state.transactions.unshift({ date: new Date().toLocaleDateString(), amt, note, cat: acc.cat, payer: acc.payer, split: acc.split });
        saveData(); renderWallet(); document.getElementById('amt-input').value = '';
    }

    function renderChecklist() {
        document.getElementById('checklist-container').innerHTML = state.checklist.map((g,gi) => `
            <div class="bg-white rounded-[28px] p-5 shadow-soft">
                <h3 class="font-bold text-sm uppercase tracking-widest text-subtle mb-3">${g.title}</h3>
                ${g.items.map((i,ii) => `<label class="flex items-center gap-3 py-2"><input type="checkbox" ${i.checked?'checked':''} onchange="state.checklist[${gi}].items[${ii}].checked=this.checked; saveData()" class="accent-ink w-4 h-4"><span class="${i.checked?'line-through text-gray-300':''}">${i.name}</span></label>`).join('')}
            </div>
        `).join('');
    }

    // --- DATA ---
    function saveData() { localStorage.setItem('bkk_2025_final', JSON.stringify(state)); }
    function loadData() { 
        const d = localStorage.getItem('bkk_2025_final'); 
        if(d) {
            // Merge loaded data but KEEP default rich itinerary if user has default structure
            const loaded = JSON.parse(d);
            // Simple check: if loaded itinerary has 0 spots or generic data, we prefer default
            if(loaded.itinerary && loaded.itinerary.length > 0) {
                 state = {...state, ...loaded};
            }
        }
    }
    async function syncToCloud(a) { 
        if(a==='upload') { await fetch(GOOGLE_SCRIPT_URL,{method:'POST',mode:'no-cors',body:JSON.stringify(state)}); alert('Backup sent!'); }
        else { const r=await fetch(GOOGLE_SCRIPT_URL+'?t='+Date.now()); const d=await r.json(); if(d && confirm('Overwrite?')){state={...state,...d}; saveData(); location.reload();} }
    }
    function translateThai() { window.open('https://translate.google.com/?sl=zh-TW&tl=th&text='+document.getElementById('thai-input').value); }
    function hardReset() { if(confirm("Reset All?")) { localStorage.removeItem('bkk_2025_final'); location.reload(); } }
</script>
</body>
</html>
